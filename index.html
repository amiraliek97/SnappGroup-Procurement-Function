<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>سیستم خرید - ونچرها (A / B)</title>

    <!-- فونت وزیر -->
    <link href="https://v1.fontapi.ir/css/Vazir" rel="stylesheet">

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Vazir', sans-serif !important; }
        body { background-color: #f5f7fa; color: #333; line-height: 1.6; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg,#3c63ac 0%,#4672c4 100%); color: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { font-size: 28px; margin-bottom: 6px; }
        
        /* تغییر سایز کارت‌ها به 189x200 */
        .ventures-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(189px,1fr)); gap: 20px; margin-bottom: 40px; }
        .venture-card { 
            background: white; 
            border-radius: 10px; 
            padding: 15px; 
            text-align: center; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.08); 
            transition: transform .25s, box-shadow .25s; 
            cursor: pointer; 
            width: 189px;
            height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .venture-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.12); }
        .venture-logo { 
            max-width: 120px; 
            max-height: 120px; 
            object-fit: contain; 
            margin-bottom: 10px;
        }
        .venture-card h3 { color: #3c63ac; margin-bottom: 8px; font-size: 16px; }

        /* modal */
        .modal { display: none; position: fixed; inset: 0; background-color: rgba(0,0,0,.7); z-index: 1000; overflow: auto; padding: 30px 16px; }
        .modal-content { background: white; margin: 2% auto; padding: 24px; border-radius: 12px; width: 100%; max-width: 1000px; position: relative; box-shadow: 0 8px 32px rgba(0,0,0,.2); direction: rtl; }
        .close-btn { position: absolute; top: 12px; left: 12px; font-size: 28px; font-weight: bold; color: #aaa; cursor: pointer; background: none; border: none; z-index: 1001; }
        .close-btn:hover { color: #333; }

        .modal-header { text-align: center; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        .modal-header h2 { color: #3c63ac; font-size: 22px; margin-bottom: 8px; }
        .venture-name-title { color: #3c63ac; font-weight: bold; font-size: 18px; margin-bottom: 5px; }
        .group-note { font-size: 14px; color: #3c63ac; font-weight: bold; margin-top: 6px; }

        /* تب‌ها */
        .tabs { display: flex; border-bottom: 2px solid #e0e0e0; margin-bottom: 20px; }
        .tab { padding: 12px 24px; cursor: pointer; border: none; background: none; font-size: 16px; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .tab.active { color: #3c63ac; border-bottom-color: #3c63ac; font-weight: 600; }
        .tab:hover { color: #4672c4; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* استایل بخش‌ها */
        .section { margin-bottom: 25px; }
        .section h3 { color: #4672c4; margin-bottom: 15px; font-size: 18px; padding-bottom: 8px; border-bottom: 1px solid #e0e0e0; }

        /* approvers list - با شماره‌گذاری */
        .approvers-list { list-style: none; padding: 12px; background-color: #f8f9fa; border-radius: 8px; margin-bottom: 12px; }
        .approvers-list li { padding: 8px 10px; border-bottom: 1px solid #e9ecef; display: flex; align-items: center; gap: 8px; }
        .approvers-list li:last-child { border-bottom: none; }
        .approver-number { background: #3c63ac; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
        .approver-role { color: #333; font-weight: 600; white-space: nowrap; }
        .approver-sep { margin: 0 6px; font-weight: 700; }
        .approver-name { min-width: 120px; border-radius: 6px; padding: 6px 8px; background: transparent; border: none; color: #333; }

        /* amounts / levels - با هدر و شماره‌گذاری */
        .amounts-section { display: grid; grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); gap: 16px; margin-top: 6px; }
        .amount-card { background:white; border:1px solid #e0e0e0; border-radius:8px; padding:12px; box-shadow:0 2px 6px rgba(0,0,0,0.04); position: relative; }
        .amount-header { background: #f0f7ff; padding: 8px 12px; margin: -12px -12px 12px -12px; border-radius: 8px 8px 0 0; border-bottom: 2px solid #3c63ac; font-weight: bold; color: #3c63ac; text-align: center; }
        .amount-card h4 { color: #3c63ac; margin-bottom: 8px; font-size: 15px; text-align: center; }
        .amount-card ul { list-style: none; padding-right: 12px; }
        .amount-card li { padding: 6px 0; font-size: 14px; position: relative; display: flex; align-items: flex-start; gap: 8px; }
        .amount-card li::before { content: ""; }
        .level-number { background: #4672c4; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; flex-shrink: 0; margin-top: 2px; }

        /* بخش زمان‌های تحویل */
        .delivery-times { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; border-right: 4px solid #3c63ac; }
        .delivery-times h3 { color: #4672c4; margin-bottom: 12px; font-size: 18px; display: flex; align-items: center; }
        .delivery-times h3::before { content: "⏱️"; margin-left: 8px; }
        .delivery-item { margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px dashed #e0e0e0; }
        .delivery-item:last-child { border-bottom: none; margin-bottom: 0; }
        .delivery-title { font-weight: 600; color: #3c63ac; margin-bottom: 4px; }
        .delivery-desc { color: #555; font-size: 14px; }

        /* بخش‌های ایمیل و مناقصه */
        .email-details, .tender-details {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .email-field, .tender-field {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .email-field:last-child, .tender-field:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .field-label {
            font-weight: 600;
            color: #3c63ac;
            margin-bottom: 5px;
            display: block;
        }
        
        .field-content {
            color: #555;
            line-height: 1.5;
        }
        
        .subject-example {
            background: #e8f4ff;
            padding: 10px;
            border-radius: 6px;
            margin: 8px 0;
            font-family: monospace;
            font-size: 14px;
            border-right: 3px solid #3c63ac;
        }
        
        .subject-explanation {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 6px;
            margin: 8px 0;
            font-size: 13px;
        }
        
        .subject-part {
            display: inline-block;
            padding: 2px 6px;
            background: #3c63ac;
            color: white;
            border-radius: 4px;
            margin: 0 2px;
            font-size: 12px;
        }

        .view-flow-btn { display:block; margin: 18px auto 6px; padding:10px 20px; background: linear-gradient(135deg,#3c63ac 0%,#4672c4 100%); color:white; border:none; border-radius:6px; cursor:pointer; font-size:15px; font-weight:600; }

        /* flow modal */
        .flow-modal { display:none; position:fixed; inset:0; background: rgba(0,0,0,.9); z-index:1100; overflow:auto; text-align:center; padding:20px; }
        .flow-content { margin: 2% auto; max-width: 96%; position: relative; display:inline-block; }
        #zoomContainer { overflow: hidden; display: inline-block; cursor: grab; max-width: 100%; }
        #flowImage { max-width: 100%; height: auto; border: 1px solid #444; border-radius: 8px; transition: transform .18s ease; transform-origin: center center; display:block; }
        .flow-close-btn { position: absolute; top: 10px; left: 10px; font-size: 28px; font-weight: bold; color: #fff; cursor: pointer; background: none; border: none; z-index: 1101; background: rgba(0,0,0,0.5); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .flow-close-btn:hover { background: rgba(0,0,0,0.7); }

        @media (max-width:768px) {
            .ventures-grid { grid-template-columns: repeat(auto-fill,minmax(189px,1fr)); }
            .amounts-section { grid-template-columns: 1fr; }
            .modal-content { width: 95%; padding: 16px; }
            .tabs { flex-wrap: wrap; }
            .tab { flex: 1; min-width: 120px; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>سیستم آموزش فرآیند خرید</h1>
            <p>ونچرهای گروه اسنپ</p>
        </header>

        <div class="ventures-grid" id="venturesGrid">
            <!-- کارت‌ها با لوگو -->
        </div>
    </div>

    <!-- Modal for venture details -->
    <div id="ventureModal" class="modal" aria-hidden="true">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <button class="close-btn" aria-label="بستن">&times;</button>
            <div class="modal-header">
                <h2 id="modalTitle">جزئیات فرآیند خرید</h2>
                <div id="ventureNameTitle" class="venture-name-title"></div>
                <div class="group-note" id="groupNote"></div>
            </div>

            <!-- تب‌ها -->
            <div class="tabs">
                <button class="tab active" data-tab="approvers">تأییدکنندگان</button>
                <button class="tab" data-tab="amounts">سطوح تأیید</button>
                <button class="tab" data-tab="email">نمونه ایمیل</button>
                <button class="tab" data-tab="tender">مناقصات</button>
            </div>

            <!-- محتوای تب‌ها -->
            <div class="tab-content active" id="approvers-tab">
                <div class="section">
                    <h3>تأییدکنندگان اصلی</h3>
                    <ul class="approvers-list" id="approversList"></ul>
                </div>
            </div>

            <div class="tab-content" id="amounts-tab">
                <div class="section">
                    <h3>سطوح تأیید بر اساس مبلغ</h3>
                    <div class="amounts-section" id="amountsSection"></div>
                    
                    <!-- بخش زمان‌های تحویل -->
                    <div class="delivery-times">
                        <h3>زمان‌های تحویل (Delivery Lead Time)</h3>
                        <div class="delivery-item">
                            <div class="delivery-title">فوری (Urgent)</div>
                            <div class="delivery-desc">طی 3 روز کاری (در صورت موجود بودن کالا در بازار داخلی)</div>
                        </div>
                        <div class="delivery-item">
                            <div class="delivery-title">موجود در بازار داخلی (Regular)</div>
                            <div class="delivery-desc">طی 10 روز کاری (در صورت موجود بودن کالا در بازار داخلی)</div>
                        </div>
                        <div class="delivery-item">
                            <div class="delivery-title">کالا های غیر قابل تامین در بازار داخلی</div>
                            <div class="delivery-desc">حداکثر 8 هفته کاری</div>
                        </div>
                        <div class="delivery-item">
                            <div class="delivery-title">فناوری های حجیم مثل سرور ها</div>
                            <div class="delivery-desc">طی 150 روز کاری</div>
                        </div>
                        <div class="delivery-item">
                            <div class="delivery-title">لایسنس ها</div>
                            <div class="delivery-desc">در صورت تامین داخلی طی 20 روز کاری و در غیر این صورت طی 120 روز کاری</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="email-tab">
                <div class="section">
                    <h3>نمونه ایمیل استاندارد</h3>
                    <div class="email-details" id="emailDetails"></div>
                </div>
            </div>

            <div class="tab-content" id="tender-tab">
                <div class="section">
                    <h3>مناقصات</h3>
                    <div class="tender-details" id="tenderDetails"></div>
                </div>
            </div>

            <button class="view-flow-btn" id="viewFlowBtn">مشاهده نمودار فرآیند</button>
        </div>
    </div>

    <!-- Modal for flowchart -->
    <div id="flowModal" class="flow-modal" aria-hidden="true">
        <div class="flow-content" id="flowContent">
            <button class="flow-close-btn" aria-label="بستن">&times;</button>
            <div id="zoomContainer">
                <img id="flowImage" src="" alt="نمودار فرآیند خرید">
            </div>
            <div style="color: white; margin-top: 10px;">برای زوم از چرخ موس استفاده کنید · دوبار کلیک برای ریست</div>
        </div>
    </div>

    <script>
        // =================== داده‌ها ===================
        const GROUP_A = ['اسنپ کب','اسنپ باکس','اسنپ فود','اسنپ پی','اسنپ مارکت','اسنپ تریپ','اسنپ کیچن','اسنپ شاپ','اسنپ اکسپرس'];
        
        // لینک‌های مستقیم لوگوها
        const ventureLogos = {
            'اسنپ کب': 'https://drive.google.com/thumbnail?id=1_rT2rKZ06oXseqSqZHemln9dBEivHVMU&sz=w400',
            'اسنپ باکس': 'https://drive.google.com/thumbnail?id=1lTmpJUvcNW0Io3e79U2dbodPz2HvCuNM&sz=w400',
            'اسنپ اکسپرس': 'https://drive.google.com/thumbnail?id=1ytsL_CVFzBAE_ohSiPzr75Tw2kDuy0y2&sz=w400',
            'اسنپ ساپلای': 'https://drive.google.com/thumbnail?id=1vOGsTSFW0O8uhWpNwmpiKReFa6G98c29&sz=w400',
            'اسنپ مارکت': 'https://drive.google.com/thumbnail?id=1u4r52ixzD1gIaN9enpFItm-8ps57bKRk&sz=w400',
            'اسنپ فود': 'https://drive.google.com/thumbnail?id=1t-E70MPJskoxNzRQIOrum8L7XuPHJVCM&sz=w400',
            'اسنپ پی': 'https://drive.google.com/thumbnail?id=1iGZJAImMjMmlvLYdeRBcb3Er-ExyMwZ7&sz=w400',
            'اسنپ گروه': 'https://drive.google.com/thumbnail?id=1hmDZtxLHpiS4DwkyAir2Uq16L3YmMLdW&sz=w400',
            'اسنپ استور': 'https://drive.google.com/thumbnail?id=1dOxdRDj2MFMj9dm5T6UcFuv9IwmcMuGx&sz=w400',
            'اسنپ تریپ': 'https://drive.google.com/thumbnail?id=1b1mbojFsj14ut9Du3VT6r6O9hO37nzNU&sz=w400',
            'اسنپ دکتر': 'https://drive.google.com/thumbnail?id=1UwV6ONXEitcpeZGJIhPTiJQmIBE1zLuq&sz=w400',
            'اسنپ شاپ': 'https://drive.google.com/thumbnail?id=1E8NduHg1WM8kaqkMVqGrDDOQDHxSUQFq&sz=w400',
            'اسنپ کیچن': 'https://drive.google.com/thumbnail?id=1CFjWd2aZRR4V1WjuMiWR_JdVnb5ZRXao&sz=w400'
        };

        // نقش‌های تأییدکنندگان جدید با شماره‌گذاری
        const APPROVER_ROLES = [
            'مدیر دپارتمان واحد درخواست دهنده',
            'مدیر تامین گروه', 
            'مدیر مالی/بودجه',
            'مدیر ارشد اجرایی ونچر (MD)',
            'مدیر عامل قانونی ونچر'
        ];

        // هدرهای معاملات
        const TRANSACTION_HEADERS = [
            'معاملات خرد',
            'معاملات کوچک', 
            'معاملات متوسط',
            'معاملات بزرگ',
            'معاملات راهبردی',
            'معاملات راهبردی'
        ];

        // کدهای ونچرها برای عنوان
        const ventureTitles = {
            'اسنپ کب': 'SnappCab - P2P Process',
            'اسنپ باکس': 'SnappBox - P2P Process',
            'اسنپ فود': 'SnappFood - P2P Process',
            'اسنپ شاپ': 'SnappShop - P2P Process',
            'اسنپ کیچن': 'SnappKitchen - P2P Process',
            'اسنپ مارکت': 'SnappMarket - P2P Process',
            'اسنپ تریپ': 'SnappTrip - P2P Process',
            'اسنپ پی': 'SnappPay - P2P Process',
            'اسنپ استور': 'SnappStore - P2P Process',
            'اسنپ دکتر': 'SnappDoctor - P2P Process',
            'اسنپ ساپلای': 'SnappSupply - P2P Process',
            'اسنپ گروه': 'SnappGroup - P2P Process',
            'اسنپ اکسپرس': 'SnappExpress - P2P Process'
        };

        // کدهای ونچرها برای سابجکت ایمیل
        const ventureCodes = {
            'اسنپ کب': 'Cab',
            'اسنپ باکس': 'Box',
            'اسنپ فود': 'Food',
            'اسنپ شاپ': 'Shop',
            'اسنپ کیچن': 'Kitchen',
            'اسنپ مارکت': 'Market',
            'اسنپ تریپ': 'Trip',
            'اسنپ پی': 'Pay',
            'اسنپ استور': 'Store',
            'اسنپ دکتر': 'Doctor',
            'اسنپ ساپلای': 'Supply',
            'اسنپ گروه': 'Group',
            'اسنپ اکسپرس': 'Express'
        };

        // لینک‌های نمودار فرآیند از گوگل درایو
        // ================================
        // لینک نمودار گروه A را اینجا قرار دهید:
        const FLOWCHART_GROUP_A = 'YOUR_GROUP_A_FLOWCHART_LINK_HERE';
        
        // لینک نمودار گروه B را اینجا قرار دهید:
        const FLOWCHART_GROUP_B = 'YOUR_GROUP_B_FLOWCHART_LINK_HERE';
        // ================================

        // انواع درخواست‌ها
        const requestTypes = ['IT', 'Marketing', 'Services', 'Real State'];
        
        // دپارتمان‌های درخواست کننده
        const departments = ['Tech', 'HR', 'Finance', 'Operations', 'Sales', 'Legal'];
        
        // اولویت‌های درخواست
        const priorities = ['Urgent', 'Regular'];

        // سطوح تأیید گروه A
        const AMOUNTS_A = [
            { title: 'تا ۴۰۰ میلیون ریال', approvers: ['مدیر دپارتمان واحد درخواست دهنده'] },
            { title: '۴۰۰ میلیون تا ۱ میلیارد ریال', approvers: ['مدیر دپارتمان واحد درخواست دهنده', 'مدیر تامین گروه'] },
            { title: '۱ تا ۴ میلیارد ریال', approvers: ['مدیر دپارتمان واحد درخواست دهنده', 'مدیر تامین گروه','مدیر مالی/بودجه','مدیر ارشد اجرایی ونچر (MD)'] },
            { title: '۴ تا ۲۰ میلیارد ریال', approvers: ['مدیر دپارتمان واحد درخواست دهنده', 'مدیر تامین گروه','مدیر مالی/بودجه','مدیر ارشد اجرایی ونچر (MD)','مدیر عامل قانونی ونچر'] },
            { title: '۲۰ تا ۱۰۰ میلیارد ریال', approvers: ['مدیر تامین گروه','مدیر مالی گروه/بودجه','مدیر ارشد اجرایی ونچر (MD)'] },
            { title: 'بالای ۱۰۰ میلیارد ریال', approvers: ['مدیر تامین گروه','مدیر مالی گروه/بودجه','مدیر ارشد اجرایی ونچر (MD)','مدیر ارشد اجرایی گروه'] }
        ];

        // سطوح تأیید گروه B
        const AMOUNTS_B = [
            { title: 'تا ۲۰۰ میلیون ریال', approvers: ['مدیر دپارتمان واحد درخواست دهنده'] },
            { title: '۲۰۰ تا ۵۰۰ میلیون ریال', approvers: ['مدیر دپارتمان واحد درخواست دهنده', 'مدیر تامین گروه'] },
            { title: '۵۰۰ میلیون تا ۲ میلیارد ریال', approvers: ['مدیر دپارتمان واحد درخواست دهنده', 'مدیر تامین گروه','مدیر مالی/بودجه','مدیر ارشد اجرایی ونچر (MD)'] },
            { title: '۲ تا ۱۰ میلیارد ریال', approvers: ['مدیر دپارتمان واحد درخواست دهنده', 'مدیر تامین گروه','مدیر مالی/بودجه','مدیر ارشد اجرایی ونچر (MD)','مدیر عامل قانونی ونچر'] },
            { title: '۱۰ تا ۱۰۰ میلیارد ریال', approvers: ['مدیر تامین گروه','مدیر مالی گروه/بودجه','مدیر ارشد اجرایی ونچر (MD)'] },
            { title: 'بالای ۱۰۰ میلیارد ریال', approvers: ['مدیر تامین گروه','مدیر مالی گروه/بودجه','مدیر ارشد اجرایی ونچر (MD)','مدیر ارشد اجرایی گروه'] }
        ];

        // اسم تأییدکنندگان اختصاصی هر ونچر (مدیر دپارتمان خالی، مابقی پر)
        const topApproversByVenture = {
            // گروه A
            'اسنپ کب': ['', 'امیررضا عطاری','جلال قارائی/سجاد صفری','محمد خلج قاسم آبادی','محمود فوز (CEO)/ محمد خلج قاسم آبادی'],
            'اسنپ باکس': ['', 'امیررضا عطاری','جلال قارائی/معصومه بروزی','کسری صادقی زاده','دانیال نقوی (CEO)/ کسری صادقی زاده'],
            'اسنپ فود': ['', 'نیما احسانی','عظیم عسکری','سعید لطفی','سعید لطفی (CEO)/ مهراد عبدالرزاق'],
            'اسنپ شاپ': ['', 'امیررضا عطاری','سهیل فرهودی','امین سمیعی','امین سمیعی (CEO)/ سهیل فرهودی'],
            'اسنپ کیچن': ['', 'امیررضا عطاری','نسرین شیرازی','کتایون شکوری','کتایون شکوری (CEO)/ آرمان وفاجو'],
            'اسنپ مارکت': ['', 'امیررضا عطاری','امین عسکری','پویا رستگار','پویا رستگار (CEO)/ رامین لایقی'],
            'اسنپ تریپ': ['', 'امیررضا عطاری','سهیل فرهودی','فرید یکانی','فرید یکانی (CEO)/ صبا مرتضوی'],
            'اسنپ پی': ['', 'امیررضا عطاری','احسان رحمانی نیا/امیرحسین درخشانی','مجید حسامی','مجید حسامی(CEO)/ احمد کازرونی'],
            'اسنپ اکسپرس': ['', 'امیررضا عطاری','امین عسکری','پویا رستگار','پویا رستگار(CEO)/رامین لایقی'],

            // گروه B
            'اسنپ استور': ['', 'امیررضا عطاری','فرناز هراتیان','نوید خدیوی',''],
            'اسنپ دکتر': ['', 'امیررضا عطاری','فرناز هراتیان','نوید آئینه','محمدرضا ماهرنیا'],
            'اسنپ ساپلای': ['', 'سینا احمدی','لیلا کامیابی','میلاد حسینی','زهرا جعفری'],
            'اسنپ گروه': ['', 'امیررضا عطاری','فرناز هراتیان','جلال قارائی','Eyad/Mahmoud'],
           
        };

        // ونچرهایی که باید "مدیر مالی/بودجه" داشته باشند
        const BUDGET_MANAGER_VENTURES = ['اسنپ کب', 'اسنپ باکس', 'اسنپ پی'];

        // داده‌های نمونه ایمیل استاندارد
        const emailTemplates = {
            'default': {
                body: 'با سلام\n\nاین ایمیل جهت درخواست خرید برای [نام ونچر] ارسال می‌گردد.\n\nجزئیات درخواست:\n- کالا/خدمت: [نام کالا یا خدمت]\n- مشحصات فنی: [برند، مدل، پارت نامبر، رنگ و ...]\n-  لینک مربوط به کالا\n- مقدار: [مقدار]\n- مبلغ تخمینی: [مبلغ]\n\nدر صورت عدم موجودی مدل درخواستی، ندل پیشنهادی تیم تامین جهت بررسی درخواست اعلام گردد.\n\n----\n\nلطفاً این درخواست را بررسی و تأیید فرمایید.\n\nبا تشکر',
                approvers: 'مدیر دپارتمان درخواست دهنده و پس از آن مدیر بودجه (درصورتی که آن ونچر مدیر بودجه داشته باشد)',
                notes: 'با توجه به فلوچارت، باید اول درخواست برای مدیر دپارتمان ارسال شود.\nبعد از تایید مدیر دپارتمان و مدیر بودجه (در صورتی که آن ونچر مدیر بودجه داشته باشد)، ایمیل Procurement Team به ایمیل مربوطه اضافه شود تا فرایند خرید آغاز شود.\n\nایمیل تیم تامین:\nProcurementTeam@Snapp.Cab\n\nتوجه: خواهشمند است ایمیل ها در قالب استاندارد درخواست شده ارسال گردد تا در اسرع وقت پروسه خرید مطابق استاندارد آغاز شود.'            }
        };

        // داده‌های مناقصات
        const tenderInfo = {
            'groupA': {
                threshold: 'بالای 4 میلیارد ریال',
                process: 'برای خریدهای بالای 4 میلیارد ریال ریال، فرآیند مناقصه الزامی است. این فرآیند شامل:\n1. تهیه اسناد مناقصه(LOM) توسط واحد درخواست دهنده\n2. نهایی سازی LOM توسط واحد تامین (لزوم عقد قرارداد، تضامین و ...)\n3. بارگزاری اسناد مناقصه در سامانه مناقصات جهت اخذ استعلام\n4. اطلاع رسانی عمومی\n5. دریافت پیشنهاد ها\n6. ارزیابی فنی (در صورت نیاز) \n7. ارزیابی قیمتی\n8. انتخاب برنده\n9. اطلاع رسانی نتیجه مناقصه به تامین کننده و واحد درخواست دهنده\n\nمی‌باشد.',
                conditions: 'مناقصه باید از لیست تامین کنندگان مورد تایید تیم تامین گروه باشد.'
            },
            'groupB': {
                threshold: 'بالای 2 میلیارد ریال',
                process: 'برای خریدهای بالای 2 میلیارد ریال، فرآیند مناقصه الزامی است. این فرآیند شامل:\n1. تهیه اسناد مناقصه(LOM) توسط واحد درخواست دهنده\n2. نهایی سازی LOM توسط واحد تامین (لزوم عقد قرارداد، تضامین و ...\n3. بارگزاری اسناد مناقصه در سامانه مناقصات جهت اخذ استعلام\n4. اطلاع رسانی عمومی\n5. دریافت پیشنهاد ها\n6. ارزیابی فنی (در صورت نیاز) \n7. ارزیابی قیمتی\n8. انتخاب برنده\n9. اطلاع رسانی نتیجه مناقصه به تامین کننده و واحد درخواست دهنده\n\nمی‌باشد.',
                conditions: 'مناقصه میبایست از میان لیست تامین کنندگان مورد تایید تیم تامین مرکزی برگزار شود.'
            }
        };

        // =================== مقداردهی اولیه ===================
        const venturesGrid = document.getElementById('venturesGrid');
        const ventureModal = document.getElementById('ventureModal');
        const flowModal = document.getElementById('flowModal');
        const closeBtns = document.querySelectorAll('.close-btn');
        const flowCloseBtn = document.querySelector('.flow-close-btn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        const modalTitle = document.getElementById('modalTitle');
        const ventureNameTitle = document.getElementById('ventureNameTitle');
        const approversList = document.getElementById('approversList');
        const amountsSection = document.getElementById('amountsSection');
        const groupNote = document.getElementById('groupNote');
        const flowImage = document.getElementById('flowImage');
        const viewFlowBtn = document.getElementById('viewFlowBtn');
        const emailDetails = document.getElementById('emailDetails');
        const tenderDetails = document.getElementById('tenderDetails');

        // ایجاد کارت‌های ونچر با لوگو
        function initializeVentureCards() {
            const ventures = [
                'اسنپ کب', 'اسنپ باکس', 'اسنپ فود', 'اسنپ شاپ', 
                'اسنپ کیچن', 'اسنپ مارکت', 'اسنپ تریپ', 'اسنپ پی','اسنپ اکسپرس',
                'اسنپ استور', 'اسنپ دکتر', 'اسنپ ساپلای', 'اسنپ گروه'
            ];

            ventures.forEach(venture => {
                const card = document.createElement('div');
                card.className = 'venture-card';
                card.dataset.venture = venture;
                
                const logo = document.createElement('img');
                logo.className = 'venture-logo';
                logo.src = ventureLogos[venture];
                logo.alt = venture;
                logo.onerror = function() {
                    this.style.display = 'none';
                    const fallbackText = document.createElement('h3');
                    fallbackText.textContent = venture;
                    card.appendChild(fallbackText);
                };
                
                const title = document.createElement('h3');
                title.textContent = venture;
                
                card.appendChild(logo);
                card.appendChild(title);
                venturesGrid.appendChild(card);
            });
        }

        // مدیریت تب‌ها
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;
                
                // غیرفعال کردن همه تب‌ها
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // فعال کردن تب انتخاب شده
                tab.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });

        // =================== انتخاب کارت و باز کردن Modal ===================
        document.addEventListener('click', (e) => {
            if (e.target.closest('.venture-card')) {
                const card = e.target.closest('.venture-card');
                const ventureName = card.dataset.venture;
                const isGroupA = GROUP_A.includes(ventureName);
                const ventureCode = ventureCodes[ventureName];

                // تنظیم عنوان مودال
                modalTitle.textContent = ventureTitles[ventureName] || `${ventureName} - P2P Process`;
                ventureNameTitle.textContent = ventureName;
                groupNote.textContent = isGroupA ? 'گروه A' : 'گروه B';

                // top approvers
                const topNames = topApproversByVenture[ventureName] || ['', '', '', '', ''];
                renderTopApproversWithNames(topNames);

                // amount cards
                const amounts = isGroupA ? AMOUNTS_A : AMOUNTS_B;
                renderAmounts(amounts);
                
                // email template
                const emailTemplate = emailTemplates[ventureName] || emailTemplates['default'];
                renderEmailTemplate(emailTemplate, ventureCode, ventureName);
                
                // tender info
                const tenderData = isGroupA ? tenderInfo['groupA'] : tenderInfo['groupB'];
                renderTenderInfo(tenderData);

                // set flowchart src based on group
                flowImage.src = isGroupA ? FLOWCHART_GROUP_A : FLOWCHART_GROUP_B;

                ventureModal.style.display = 'block';
                
                // بازگشت به تب اول
                tabs.forEach((tab, index) => {
                    if (index === 0) {
                        tab.classList.add('active');
                        tabContents[index].classList.add('active');
                    } else {
                        tab.classList.remove('active');
                        tabContents[index].classList.remove('active');
                    }
                });
            }
        });

        // مدیریت دکمه‌های بستن
        closeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.modal').style.display = 'none';
            });
        });

        flowCloseBtn.addEventListener('click', () => {
            flowModal.style.display = 'none';
        });

        window.addEventListener('click', e => {
            if(e.target === ventureModal) ventureModal.style.display='none';
            if(e.target === flowModal) flowModal.style.display='none';
        });

        function clearChildren(el) { while(el.firstChild) el.removeChild(el.firstChild); }

        // تابع جدید برای نمایش تأییدکنندگان با شماره‌گذاری
        function renderTopApproversWithNames(names){
            clearChildren(approversList);
            APPROVER_ROLES.forEach((role,i)=>{
                const li = document.createElement('li');

                const numberSpan = document.createElement('span');
                numberSpan.className = 'approver-number';
                numberSpan.textContent = i + 1;

                const roleSpan = document.createElement('span');
                roleSpan.className = 'approver-role';
                // تنظیم عنوان مدیر مالی/بودجه برای ونچرهای خاص
                if (role === 'مدیر مالی/بودجه') {
                    const ventureName = document.querySelector('.venture-name-title').textContent;
                    roleSpan.textContent = BUDGET_MANAGER_VENTURES.includes(ventureName) ? 'مدیر مالی/بودجه' : 'مدیر مالی';
                } else {
                    roleSpan.textContent = role;
                }

                const sep = document.createElement('span');
                sep.className = 'approver-sep';
                sep.textContent = ':';

                const nameSpan = document.createElement('span');
                nameSpan.className = 'approver-name';
                nameSpan.textContent = names[i] || '';

                li.appendChild(numberSpan);
                li.appendChild(roleSpan);
                li.appendChild(sep);
                li.appendChild(nameSpan);

                approversList.appendChild(li);
            });
        }

        // تابع جدید برای نمایش سطوح تأیید با هدر و شماره‌گذاری
        function renderAmounts(amounts){
            clearChildren(amountsSection);
            amounts.forEach((a, index)=>{
                const card = document.createElement('div');
                card.className = 'amount-card';
                
                // اضافه کردن هدر معاملات
                const header = document.createElement('div');
                header.className = 'amount-header';
                header.textContent = TRANSACTION_HEADERS[index];
                card.appendChild(header);

                const h4 = document.createElement('h4');
                h4.textContent = a.title;
                card.appendChild(h4);

                const ul = document.createElement('ul');
                a.approvers.forEach((role, roleIndex)=>{
                    const li = document.createElement('li');
                    
                    const numberSpan = document.createElement('span');
                    numberSpan.className = 'level-number';
                    numberSpan.textContent = roleIndex + 1;
                    
                    const roleSpan = document.createElement('span');
                    // تنظیم عنوان مدیر مالی/بودجه برای ونچرهای خاص
                    if (role === 'مدیر مالی/بودجه') {
                        const ventureName = document.querySelector('.venture-name-title').textContent;
                        roleSpan.textContent = BUDGET_MANAGER_VENTURES.includes(ventureName) ? 'مدیر مالی/بودجه' : 'مدیر مالی';
                    } else {
                        roleSpan.textContent = role;
                    }
                    
                    li.appendChild(numberSpan);
                    li.appendChild(roleSpan);
                    ul.appendChild(li);
                });
                card.appendChild(ul);
                amountsSection.appendChild(card);
            });
        }
        
        // تابع نمایش نمونه ایمیل استاندارد
        function renderEmailTemplate(emailTemplate, ventureCode, ventureName) {
            clearChildren(emailDetails);
            
            const today = new Date();
            const persianDate = today.toLocaleDateString('fa-IR').replace(/\//g, '');
            
            const prSubjectUrgent = `PR:${ventureCode}-IT-Tech-${persianDate}-Urgent`;
            const prSubjectRegular = `PR:${ventureCode}-IT-Tech-${persianDate}-Regular`;
            const benchmarkSubject = `BenchMark:${ventureCode}-IT-HR-${persianDate}-Regular`;
            
            // سابجکت ایمیل - PR فوری
            const prSubjectUrgentField = document.createElement('div');
            prSubjectUrgentField.className = 'email-field';
            prSubjectUrgentField.innerHTML = `
                <span class="field-label">سابجکت ایمیل (درخواست خرید فوری - PR):</span>
                <div class="subject-example">${prSubjectUrgent}</div>
                <div class="subject-explanation">
                    <strong>معنی بخش‌های سابجکت:</strong><br>
                    <span class="subject-part">PR</span>: درخواست خرید (Purchase Request)<br>
                    <span class="subject-part">${ventureCode}</span>: کد ونچر (${ventureName})<br>
                    <span class="subject-part">IT</span>: کتگوری کالا/خدمات<br>
                    <span class="subject-part">Tech</span>: دپارتمان درخواست کننده<br>
                    <span class="subject-part">${persianDate}</span>: تاریخ درخواست<br>
                    <span class="subject-part">Urgent</span>: اولویت فوری (طی 3 روز کاری و در صورت موجود بودن در بازار داخلی)
                </div>
            `;
            emailDetails.appendChild(prSubjectUrgentField);
            
            // سابجکت ایمیل - PR معمولی
            const prSubjectRegularField = document.createElement('div');
            prSubjectRegularField.className = 'email-field';
            prSubjectRegularField.innerHTML = `
                <span class="field-label">سابجکت ایمیل (درخواست خرید معمولی - PR):</span>
                <div class="subject-example">${prSubjectRegular}</div>
                <div class="subject-explanation">
                    <strong>معنی بخش‌های سابجکت:</strong><br>
                    <span class="subject-part">PR</span>: درخواست خرید (Purchase Request)<br>
                    <span class="subject-part">${ventureCode}</span>: کد ونچر (${ventureName})<br>
                    <span class="subject-part">IT</span>: کتگوری کالا/خدمت<br>
                    <span class="subject-part">Tech</span>: دپارتمان درخواست کننده<br>
                    <span class="subject-part">${persianDate}</span>: تاریخ درخواست<br>
                    <span class="subject-part">Regular</span>: اولویت معمولی (طی 10 روز کاری)
                </div>
            `;
            emailDetails.appendChild(prSubjectRegularField);
            
            // سابجکت ایمیل - BenchMark
            const benchmarkSubjectField = document.createElement('div');
            benchmarkSubjectField.className = 'email-field';
            benchmarkSubjectField.innerHTML = `
                <span class="field-label">سابجکت ایمیل (استعلام قیمت - BenchMark):</span>
                <div class="subject-example">${benchmarkSubject}</div>
                <div class="subject-explanation">
                    <strong>معنی بخش‌های سابجکت:</strong><br>
                    <span class="subject-part">BenchMark</span>: استعلام قیمت<br>
                    <span class="subject-part">${ventureCode}</span>: کد ونچر (${ventureName})<br>
                    <span class="subject-part">IT</span>: کتگوری کالا/خدمت<br>
                    <span class="subject-part">HR</span>: دپارتمان درخواست کننده<br>
                    <span class="subject-part">${persianDate}</span>: تاریخ درخواست<br>
                    <span class="subject-part">Regular</span>: اولویت معمولی
                </div>
            `;
            emailDetails.appendChild(benchmarkSubjectField);
            
            // توضیحات درباره انواع سابجکت
            const subjectTypesField = document.createElement('div');
            subjectTypesField.className = 'email-field';
            subjectTypesField.innerHTML = `
                <span class="field-label">انواع سابجکت و کاربرد آنها:</span>
                <div class="field-content">
                    <strong>PR (Purchase Request):</strong> برای درخواست خرید - هر ایمیلی که با این کلمه شروع شود به منزله درخواست خرید است<br>
                    <strong>BenchMark:</strong> برای استعلام قیمت - واحد تامین سنترال برای کالاها یا خدمات درخواستی استعلام قیمت انجام می‌دهد<br><br>
                    
                    <strong>انواع درخواست (بخش دوم سابجکت):</strong><br>
                    ${requestTypes.map(type => `• ${type}`).join('<br>')}<br><br>
                    
                    <strong>دپارتمان‌های درخواست کننده (بخش سوم سابجکت):</strong><br>
                    ${departments.map(dept => `• ${dept}`).join('<br>')}<br><br>
                    
                    <strong>اولویت‌های درخواست (بخش آخر سابجکت):</strong><br>
                    • <strong>Urgent</strong>: فوری - طی 3 روز کاری (در صورت موجود بودن کالا در بازار داخلی) انجام می‌شود<br>
                    • <strong>Regular</strong>: معمولی - در صورت موجود بودن در بازار داخلی طی 10 روز کاری انجام می‌شود
                </div>
            `;
            emailDetails.appendChild(subjectTypesField);
            
            // متن ایمیل
            const bodyField = document.createElement('div');
            bodyField.className = 'email-field';
            bodyField.innerHTML = `
                <span class="field-label">متن ایمیل:</span>
                <div class="field-content" style="white-space: pre-line;">${emailTemplate.body.replace('[نام ونچر]', ventureName)}</div>
            `;
            emailDetails.appendChild(bodyField);
            
            // نفرات تایید کننده
            const approversField = document.createElement('div');
            approversField.className = 'email-field';
            approversField.innerHTML = `
                <span class="field-label">نفرات تایید کننده:</span>
                <div class="field-content">${emailTemplate.approvers}</div>
            `;
            emailDetails.appendChild(approversField);
            
            // سایر توضیحات
            const notesField = document.createElement('div');
            notesField.className = 'email-field';
            notesField.innerHTML = `
                <span class="field-label">سایر توضیحات:</span>
                <div class="field-content" style="white-space: pre-line;">${emailTemplate.notes}</div>
            `;
            emailDetails.appendChild(notesField);
        }
        
        // تابع نمایش اطلاعات مناقصات
        function renderTenderInfo(tenderData) {
            clearChildren(tenderDetails);
            
            const thresholdField = document.createElement('div');
            thresholdField.className = 'tender-field';
            thresholdField.innerHTML = `
                <span class="field-label">آستانه مبلغی برای مناقصه:</span>
                <div class="field-content">${tenderData.threshold}</div>
            `;
            tenderDetails.appendChild(thresholdField);
            
            const processField = document.createElement('div');
            processField.className = 'tender-field';
            processField.innerHTML = `
                <span class="field-label">فرآیند مناقصه:</span>
                <div class="field-content" style="white-space: pre-line;">${tenderData.process}</div>
            `;
            tenderDetails.appendChild(processField);
            
            const conditionsField = document.createElement('div');
            conditionsField.className = 'tender-field';
            conditionsField.innerHTML = `
                <span class="field-label">شرایط و ضوابط:</span>
                <div class="field-content" style="white-space: pre-line;">${tenderData.conditions}</div>
            `;
            tenderDetails.appendChild(conditionsField);
        }

        // =================== flow modal ===================
        viewFlowBtn.addEventListener('click', () => { 
            flowModal.style.display='block'; 
        });

        // zoom / pan
        const zoomContainer = document.getElementById('zoomContainer');
        let scale = 1;
        flowImage.addEventListener('wheel', e=>{
            e.preventDefault();
            scale += e.deltaY * -0.001;
            scale = Math.min(Math.max(0.2, scale), 3);
            flowImage.style.transform = `scale(${scale})`;
        });
        flowImage.addEventListener('dblclick', ()=>{ scale=1; flowImage.style.transform=`scale(1)`; });

        let isDragging=false, startX, startY, scrollLeft, scrollTop;
        zoomContainer.addEventListener('mousedown', e=>{
            isDragging=true; zoomContainer.style.cursor='grabbing';
            startX=e.pageX - zoomContainer.offsetLeft;
            startY=e.pageY - zoomContainer.offsetTop;
            scrollLeft=zoomContainer.scrollLeft;
            scrollTop=zoomContainer.scrollTop;
        });
        window.addEventListener('mouseup', ()=>{ isDragging=false; zoomContainer.style.cursor='grab'; });
        zoomContainer.addEventListener('mousemove', e=>{
            if(!isDragging) return;
            e.preventDefault();
            const x=e.pageX - zoomContainer.offsetLeft;
            const y=e.pageY - zoomContainer.offsetTop;
            const walkX = (x - startX);
            const walkY = (y - startY);
            zoomContainer.scrollLeft = scrollLeft - walkX;
            zoomContainer.scrollTop = scrollTop - walkY;
        });

        // مقداردهی اولیه
        initializeVentureCards();
    </script>
</body>
</html>